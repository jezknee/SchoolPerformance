---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(readxl)
library(dplyr)
data_ks4_input <- read_excel("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\england_ks4final.xlsx")
head(data_ks4_input, 5)
```

```{r}
data_ks4 <- data.frame(data_ks4_input[,c("RECTYPE","LEA","ESTAB","URN","SCHNAME","PCODE","PCON_CODE","NFTYPE","RELDENOM","ADMPOL_PT","EGENDER","FEEDER","PGPUP","ATT8SCR","P8PUP")])
head(data_ks4,50)
```
```{r}
# you need the comma afterwards, because it's [rows, columns]
data_ks4_2 <- data_ks4[!is.na(data_ks4$ATT8SCR) & data_ks4$ATT8SCR != "NE" & !is.na(data_ks4$SCHNAME), ]
head(data_ks4_2,50)
```

```{r}
lookup_lsoa_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\PCD_OA21_LSOA21_MSOA21_LAD_MAY25_UK_LU.csv")
head(lookup_lsoa_input, 50)
```

```{r}
lookup_lsoa <- data.frame(lookup_lsoa_input[,c("pcds", "oa21cd", "lsoa21cd", "msoa21cd", "ladcd")])
names(lookup_lsoa)[names(lookup_lsoa) == 'pcds'] <- 'PCODE'
names(lookup_lsoa)[names(lookup_lsoa) == 'lsoa21cd'] <- 'LSOA_code'
names(lookup_lsoa)[names(lookup_lsoa) == 'msoa21cd'] <- 'MSOA_code'
head(lookup_lsoa, 5)
```


```{r}
joined_ks4_lookup <- data_ks4_2 |> left_join(lookup_lsoa, by = "PCODE")
head(joined_ks4_lookup, 50)
```

```{r}
parks_input <- read_excel("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\LSOA access to parks and playing fields.xlsx")
#head(parks_input, 50)
#colnames(parks_input)
names(parks_input)[names(parks_input) == 'Average distance to nearest Park, Public Garden, or Playing Field (m)'] <- 'AVGPARKDIST'
names(parks_input)[names(parks_input) == 'Average combined size of  Parks, Public Gardens, or Playing Fields within 1,000 m radius (m2)'] <- 'SUMPARKSIZE'
names(parks_input)[names(parks_input) == "LSOA code"] <- 'LSOA_code'
parks <- data.frame(parks_input[,c("LSOA_code", "AVGPARKDIST", "SUMPARKSIZE")])
head(parks, 50)
```
```{r}
joined_ks4_2 <- joined_ks4_lookup |> left_join(parks, by = "LSOA_code")
head(joined_ks4_2, 50)
```
```{r}
qual_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Qualifications_Census.csv")
qual <- data.frame(qual_input)
colnames(qual) <- c("Date", "Geography", "MSOA_code", "All", "No_qual", "Level_1", "Level_2", "Apprenticeship", "Level_3", "Level_4", "Other_qual")
head(qual, 50)
```

```{r}
num_cols <- setdiff(names(qual)[sapply(qual, is.numeric)], "All")
qual[num_cols] <- lapply(qual[num_cols], function(x) x / qual$All)

# Now all numerical columns (except "All") are proportions
qual <- data.frame(qual[,c("MSOA_code","No_qual","Level_1","Level_2","Apprenticeship","Level_3","Level_4","Other_qual")])
head(qual)
```

```{r}
joined_ks4_3 <- joined_ks4_2 |> left_join(qual, by = "MSOA_code")
head(joined_ks4_3, 50)
```
```{r}
religion_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Religion_Census.csv")

colnames(religion_input)
religion <- data.frame(religion_input[,c("geography.code",  "Religion..detailed...Total..All.Usual.Residents","Religion..detailed...Christian", "Religion..detailed...Buddhist","Religion..detailed...Hindu","Religion..detailed...Jewish","Religion..detailed...Muslim","Religion..detailed...Sikh","Religion..detailed...No.religion","Religion..detailed...Other.religion","Religion..detailed...Religion.not.stated")])
colnames(religion) <- c("MSOA_code","All","Christian","Buddhist","Hindu","Jewish","Muslim","Sikh","No_Religion","Other_Religion","Religion_Not_Stated")
religion$All <- (religion$All - religion$Religion_Not_Stated)
religion <- subset(religion, select = -c(Religion_Not_Stated))

num_cols <- setdiff(names(religion)[sapply(religion, is.numeric)], "All")
religion[num_cols] <- lapply(religion[num_cols], function(x) x / religion$All)
religion <- subset(religion, select = -c(All))

head(religion)

joined_ks4_4 <- joined_ks4_3 |> left_join(religion, by = "MSOA_code")
head(joined_ks4_4, 50)
```
```{r}
travel_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Travel_To_Work_Census.csv")

colnames(travel_input)
colnames(travel_input) <- c("Date", "Geography", "MSOA_code", "All", "Work_Home", "Work_Underground_Tram","Work_Train","Work_Bus","Work_Taxi","Work_Motorcycle","Work_Drive","Work_Passenger","Work_Bicycle","Work_Foot","Work_Other_Travel")

travel <- subset(travel_input, select = -c(Date, Geography))

head(travel)

num_cols <- setdiff(names(travel)[sapply(travel, is.numeric)], "All")
travel[num_cols] <- lapply(travel[num_cols], function(x) x / travel$All)
travel <- subset(travel, select = -c(All))

head(travel)

joined_ks4_5 <- joined_ks4_4 |> left_join(travel, by = "MSOA_code")
head(joined_ks4_5, 50)

```

```{r}
# armed forces - veterans
armed_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Armed_Forces_Census.csv")
colnames(armed_input)
colnames(armed_input) <- c("Date", "Geography", "MSOA_code", "All", "Armed_Forces", "Reserve_Armed_Forces", "Both_Armed_Forces", "Any_Armed_Forces")

armed <- subset(armed_input, select = -c(Date, Geography))

head(armed)

num_cols <- setdiff(names(armed)[sapply(armed, is.numeric)], "All")
armed[num_cols] <- lapply(armed[num_cols], function(x) x / armed$All)
armed <- subset(armed, select = -c(All, Armed_Forces, Reserve_Armed_Forces, Both_Armed_Forces))
armed$Any_Armed_Forces <- 1 - armed$Any_Armed_Forces
head(armed)

joined_ks4_6 <- joined_ks4_5 |> left_join(armed, by = "MSOA_code")
head(joined_ks4_6, 50)

```


```{r}
# number of bedrooms
bedrooms_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Bedrooms_Census.csv")
colnames(bedrooms_input)
colnames(bedrooms_input) <- c("Date", "Geography", "MSOA_code", "All", "One_Bedroom", "Two_Bedrooms", "Three_Bedrooms", "Four_Plus_Bedrooms")

bedrooms <- subset(bedrooms_input, select = -c(Date, Geography))

num_cols <- setdiff(names(bedrooms)[sapply(bedrooms, is.numeric)], "All")
bedrooms[num_cols] <- lapply(bedrooms[num_cols], function(x) x / bedrooms$All)

head(bedrooms)

bedrooms <- subset(bedrooms, select = -c(All))

joined_ks4_7 <- joined_ks4_6 |> left_join(bedrooms, by = "MSOA_code")
head(joined_ks4_7, 50)

```

```{r}
# unpaid care
care_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Care_Provision_Census.csv")
colnames(care_input)
colnames(care_input) <- c("Date", "Geography", "MSOA_code", "All", "No_Care", "Care_19", "Care_9", "Care_10_19","Care_20_49","Care_20_34","Care_35_49","Care_50_Plus")

care <- subset(care_input, select = -c(Date, Geography, Care_9, Care_10_19, Care_20_34, Care_35_49))

head(care)

num_cols <- setdiff(names(care)[sapply(care, is.numeric)], "All")
care[num_cols] <- lapply(care[num_cols], function(x) x / care$All)

care <- subset(care, select = -c(All))

joined_ks4_8 <- joined_ks4_7 |> left_join(care, by = "MSOA_code")
head(joined_ks4_8, 50)

```
```{r}
heating_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Central_Heating_Census.csv")
colnames(heating_input)

colnames(heating_input) <- c("Date","Geography","MSOA_code","All","No_Central_Heating","Heating_Mains_Gas","Heating_Bottled_Gas","Heating_Electric","Heating_Oil","Heating_Wood","Heating_Solid_Fuel","Heating_Renewable","Heating_Heat_Networks","Heating_Other_Central","Heating_Two_Not_Renewable","Heating_Two_Renewable")

heating <- subset(heating_input, select = -c(Date, Geography))

num_cols <- setdiff(names(heating)[sapply(heating, is.numeric)], "All")
heating[num_cols] <- lapply(heating[num_cols], function(x) x / heating$All)

heating <- subset(heating, select = -c(All))

head(heating)

joined_ks4_9 <- joined_ks4_8 |> left_join(heating, by = "MSOA_code")
head(joined_ks4_9, 50)
```
```{r}
country_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Country_Of_Birth_Census.csv")
colnames(country_input)
colnames(country_input) <- c("Date","Geography","MSOA_code","All","Country_Europe_All","Country_UK","Country_EU_All","Country_EU14","Country_EU8","Country_EU2","Country_EU_Other","Country_Europe_NonEU","Country_Europe_NonEU_All","Country_Africa","Country_Middle_East_Asia","Country_Americas","Country_Oceania","Country_British_Overseas")

country <- subset(country_input, select = -c(Date, Geography, Country_Europe_All,Country_EU14,Country_EU8,Country_EU2,Country_EU_Other,Country_Europe_NonEU))

num_cols <- setdiff(names(country)[sapply(country, is.numeric)], "All")
country[num_cols] <- lapply(country[num_cols], function(x) x / country$All)

country <- subset(country, select = -c(All))

joined_ks4_10 <- joined_ks4_9 |> left_join(country, by = "MSOA_code")
head(joined_ks4_10, 50)



```
```{r}
#Disability

disability_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Disability_Census.csv")
colnames(disability_input)

colnames(disability_input) <- c("Date","Geography","MSOA_code","All","Disabled_All","Disabled_Limited_Lot", "Disabled_Limited_Little","Not_Disabled_All","Not_Disabled_LongTermCondition","Not_Disabled_None")

disability <- subset(disability_input, select = -c(Date, Geography, Disabled_Limited_Lot, Disabled_Limited_Little,Not_Disabled_All))

num_cols <- setdiff(names(disability)[sapply(disability, is.numeric)], "All")
disability[num_cols] <- lapply(disability[num_cols], function(x) x / disability$All)

disability <- subset(disability, select = -c(All))

head(disability)

joined_ks4_11 <- joined_ks4_10 |> left_join(disability, by = "MSOA_code")
head(joined_ks4_11, 50)
```

```{r}
#Energy Efficiency
```

```{r}
#Ethnicity
```

```{r}
#Industry
industry_input = read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Industry_Census.csv")
colnames(industry_input)
industry <- subset(industry_input, select = c("geography.code", "Industry..current...Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census", "Industry..current...A..Agriculture..Forestry.and.fishing","Industry..current...B..Mining.and.quarrying","Industry..current...C..Manufacturing","Industry..current...D..Electricity..gas..steam.and.air.conditioning.supply","Industry..current...E...Water.supply..Sewerage..Waste.management.and.Remediation.activities","Industry..current...F..Construction","Industry..current...G..Wholesale.and.retail.trade..repair.of.motor.vehicles.and.motorcycles","Industry..current...H..Transport.and.storage","Industry..current...I..Accommodation.and.food.service.activities","Industry..current...J..Information.and.communication","Industry..current...K..Financial.and.insurance.activities","Industry..current...L..Real.estate.activities","Industry..current...M..Professional..scientific.and.technical.activities","Industry..current...N..Administrative.and.support.service.activities","Industry..current...O..Public.administration.and.defence..compulsory.social.security","Industry..current...P..Education","Industry..current...Q..Human.health.and.social.work.activities","Industry..current...R..S..T..U.Other"))

colnames(industry) <- c("MSOA_code","All", "Industry_A_Agriculture","Industry_B_Mining","Industry_C_Manufacturing","Industry_D_Electricity","Industry_E_Water","Industry_F_Construction","Industry_G_Retail","Industry_H_Transport","Industry_I_Accommodation","Industry_J_Information","Industry_K_Financial","Industry_L_Real_Estate","Industry_M_Professional_Technical","Industry_N_Admin","Industry_O_Defence","Industry_P_Education","Industry_Q_Health","Industry_R_Other")

num_cols <- setdiff(names(industry)[sapply(industry, is.numeric)], "All")
industry[num_cols] <- lapply(industry[num_cols], function(x) x / industry$All)

industry <- subset(industry, select = -c(All))

head(industry)

joined_ks4_12 <- joined_ks4_11 |> left_join(industry, by = "MSOA_code")
head(joined_ks4_12, 50)
```

```{r}
#Language
language_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Language_Census.csv")
colnames(language_input)
colnames(language_input) <- c("Date","Geography","MSOA_code","All","Language_EnglishWelsh_All","Language_EnglishWelsh_Some","Language_EnglishWelsh_Some_NoAdults","Language_EnglishWelsh_None")

language <- subset(language_input, select = -c(Date, Geography))

num_cols <- setdiff(names(language)[sapply(language, is.numeric)], "All")
language[num_cols] <- lapply(language[num_cols], function(x) x / language$All)

language <- subset(language, select = -c(All))

head(language)

joined_ks4_13 <- joined_ks4_12 |> left_join(language, by = "MSOA_code")
head(joined_ks4_13, 50)

```

```{r}
# Length of Residence
```

```{r}
#Living arrangements
```

```{r}
#Occupation
```

```{r}
#Vote 2019
```

```{r}
#Vote 2023
```

```{r}
# Broadband
```

```{r}
#Indices of Deprivation
```

```{r}
# crime - street
```

```{r}
# mean income
```

```{r}
# life expectancy
```

```{r}
# #GDP per MSOA
```

