---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 

```{r}
library(readxl)
library(dplyr)
data_ks4_input <- read_excel("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\england_ks4final.xlsx")
head(data_ks4_input, 5)
```

```{r}
data_ks4 <- data.frame(data_ks4_input[,c("RECTYPE","LEA","ESTAB","URN","SCHNAME","PCODE","PCON_CODE","PCON_NAME","NFTYPE","RELDENOM","ADMPOL_PT","EGENDER","FEEDER","PGPUP","ATT8SCR","P8PUP")])
head(data_ks4,50)
```
```{r}
# you need the comma afterwards, because it's [rows, columns]
data_ks4_2 <- data_ks4[!is.na(data_ks4$ATT8SCR) & data_ks4$ATT8SCR != "NE" & !is.na(data_ks4$SCHNAME), ]
head(data_ks4_2,50)
```

```{r}
lookup_lsoa_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\PCD_OA21_LSOA21_MSOA21_LAD_MAY25_UK_LU.csv")
head(lookup_lsoa_input, 50)
```

```{r}
lookup_lsoa <- data.frame(lookup_lsoa_input[,c("pcds", "oa21cd", "lsoa21cd", "msoa21cd", "ladcd")])
names(lookup_lsoa)[names(lookup_lsoa) == 'pcds'] <- 'PCODE'
names(lookup_lsoa)[names(lookup_lsoa) == 'lsoa21cd'] <- 'LSOA_code'
names(lookup_lsoa)[names(lookup_lsoa) == 'msoa21cd'] <- 'MSOA_code'
head(lookup_lsoa, 5)
```
```{r}
pcon_lookup <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\pcd_pcon_uk_lu_may_24.csv")
names(pcon_lookup)[names(pcon_lookup) == 'pcd'] <- 'PCODE'
names(pcon_lookup)[names(pcon_lookup) == 'pconcd'] <- 'PCON_CODE'
names(pcon_lookup)[names(pcon_lookup) == 'pconnm'] <- 'PCON_NAME'
head(pcon_lookup)


```


```{r}
joined_ks4_lookup <- data_ks4_2 |> left_join(lookup_lsoa, by = "PCODE")
head(joined_ks4_lookup, 50)
```

```{r}
#joined_ks4_1 <- joined_ks4_lookup |> left_join(pcon_lookup, by = "PCODE")
#head(joined_ks4_1, 100)
```

```{r}
parks_input <- read_excel("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\LSOA access to parks and playing fields.xlsx")
#head(parks_input, 50)
#colnames(parks_input)
names(parks_input)[names(parks_input) == 'Average distance to nearest Park, Public Garden, or Playing Field (m)'] <- 'AVGPARKDIST'
names(parks_input)[names(parks_input) == 'Average combined size of  Parks, Public Gardens, or Playing Fields within 1,000 m radius (m2)'] <- 'SUMPARKSIZE'
names(parks_input)[names(parks_input) == "LSOA code"] <- 'LSOA_code'
parks <- data.frame(parks_input[,c("LSOA_code", "AVGPARKDIST", "SUMPARKSIZE")])
head(parks, 50)
```
```{r}
joined_ks4_2 <- joined_ks4_lookup |> left_join(parks, by = "LSOA_code")
head(joined_ks4_2, 50)
```
```{r}
qual_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Qualifications_Census.csv")
qual <- data.frame(qual_input)
colnames(qual) <- c("Date", "Geography", "MSOA_code", "All", "No_qual", "Level_1", "Level_2", "Apprenticeship", "Level_3", "Level_4", "Other_qual")
head(qual, 50)
```

```{r}
num_cols <- setdiff(names(qual)[sapply(qual, is.numeric)], "All")
qual[num_cols] <- lapply(qual[num_cols], function(x) x / qual$All)

# Now all numerical columns (except "All") are proportions
qual <- data.frame(qual[,c("MSOA_code","No_qual","Level_1","Level_2","Apprenticeship","Level_3","Level_4","Other_qual")])
head(qual)
```

```{r}
joined_ks4_3 <- joined_ks4_2 |> left_join(qual, by = "MSOA_code")
head(joined_ks4_3, 50)
```
```{r}
religion_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Religion_Census.csv")

colnames(religion_input)
religion <- data.frame(religion_input[,c("geography.code",  "Religion..detailed...Total..All.Usual.Residents","Religion..detailed...Christian", "Religion..detailed...Buddhist","Religion..detailed...Hindu","Religion..detailed...Jewish","Religion..detailed...Muslim","Religion..detailed...Sikh","Religion..detailed...No.religion","Religion..detailed...Other.religion","Religion..detailed...Religion.not.stated")])
colnames(religion) <- c("MSOA_code","All","Christian","Buddhist","Hindu","Jewish","Muslim","Sikh","No_Religion","Other_Religion","Religion_Not_Stated")
religion$All <- (religion$All - religion$Religion_Not_Stated)
religion <- subset(religion, select = -c(Religion_Not_Stated))

num_cols <- setdiff(names(religion)[sapply(religion, is.numeric)], "All")
religion[num_cols] <- lapply(religion[num_cols], function(x) x / religion$All)
religion <- subset(religion, select = -c(All))

head(religion)

joined_ks4_4 <- joined_ks4_3 |> left_join(religion, by = "MSOA_code")
head(joined_ks4_4, 50)
```
```{r}
travel_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Travel_To_Work_Census.csv")

colnames(travel_input)
colnames(travel_input) <- c("Date", "Geography", "MSOA_code", "All", "Work_Home", "Work_Underground_Tram","Work_Train","Work_Bus","Work_Taxi","Work_Motorcycle","Work_Drive","Work_Passenger","Work_Bicycle","Work_Foot","Work_Other_Travel")

travel <- subset(travel_input, select = -c(Date, Geography))

head(travel)

num_cols <- setdiff(names(travel)[sapply(travel, is.numeric)], "All")
travel[num_cols] <- lapply(travel[num_cols], function(x) x / travel$All)
travel <- subset(travel, select = -c(All))

head(travel)

joined_ks4_5 <- joined_ks4_4 |> left_join(travel, by = "MSOA_code")
head(joined_ks4_5, 50)

```

```{r}
# armed forces - veterans
armed_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Armed_Forces_Census.csv")
colnames(armed_input)
colnames(armed_input) <- c("Date", "Geography", "MSOA_code", "All", "Armed_Forces", "Reserve_Armed_Forces", "Both_Armed_Forces", "Any_Armed_Forces")

armed <- subset(armed_input, select = -c(Date, Geography))

head(armed)

num_cols <- setdiff(names(armed)[sapply(armed, is.numeric)], "All")
armed[num_cols] <- lapply(armed[num_cols], function(x) x / armed$All)
armed <- subset(armed, select = -c(All, Armed_Forces, Reserve_Armed_Forces, Both_Armed_Forces))
armed$Any_Armed_Forces <- 1 - armed$Any_Armed_Forces
head(armed)

joined_ks4_6 <- joined_ks4_5 |> left_join(armed, by = "MSOA_code")
head(joined_ks4_6, 50)

```


```{r}
# number of bedrooms
bedrooms_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Bedrooms_Census.csv")
colnames(bedrooms_input)
colnames(bedrooms_input) <- c("Date", "Geography", "MSOA_code", "All", "One_Bedroom", "Two_Bedrooms", "Three_Bedrooms", "Four_Plus_Bedrooms")

bedrooms <- subset(bedrooms_input, select = -c(Date, Geography))

num_cols <- setdiff(names(bedrooms)[sapply(bedrooms, is.numeric)], "All")
bedrooms[num_cols] <- lapply(bedrooms[num_cols], function(x) x / bedrooms$All)

head(bedrooms)

bedrooms <- subset(bedrooms, select = -c(All))

joined_ks4_7 <- joined_ks4_6 |> left_join(bedrooms, by = "MSOA_code")
head(joined_ks4_7, 50)

```

```{r}
# unpaid care
care_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Care_Provision_Census.csv")
colnames(care_input)
colnames(care_input) <- c("Date", "Geography", "MSOA_code", "All", "No_Care", "Care_19", "Care_9", "Care_10_19","Care_20_49","Care_20_34","Care_35_49","Care_50_Plus")

care <- subset(care_input, select = -c(Date, Geography, Care_9, Care_10_19, Care_20_34, Care_35_49))

head(care)

num_cols <- setdiff(names(care)[sapply(care, is.numeric)], "All")
care[num_cols] <- lapply(care[num_cols], function(x) x / care$All)

care <- subset(care, select = -c(All))

joined_ks4_8 <- joined_ks4_7 |> left_join(care, by = "MSOA_code")
head(joined_ks4_8, 50)

```
```{r}
heating_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Central_Heating_Census.csv")
colnames(heating_input)

colnames(heating_input) <- c("Date","Geography","MSOA_code","All","No_Central_Heating","Heating_Mains_Gas","Heating_Bottled_Gas","Heating_Electric","Heating_Oil","Heating_Wood","Heating_Solid_Fuel","Heating_Renewable","Heating_Heat_Networks","Heating_Other_Central","Heating_Two_Not_Renewable","Heating_Two_Renewable")

heating <- subset(heating_input, select = -c(Date, Geography))

num_cols <- setdiff(names(heating)[sapply(heating, is.numeric)], "All")
heating[num_cols] <- lapply(heating[num_cols], function(x) x / heating$All)

heating <- subset(heating, select = -c(All))

head(heating)

joined_ks4_9 <- joined_ks4_8 |> left_join(heating, by = "MSOA_code")
head(joined_ks4_9, 50)
```
```{r}
country_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Country_Of_Birth_Census.csv")
colnames(country_input)
colnames(country_input) <- c("Date","Geography","MSOA_code","All","Country_Europe_All","Country_UK","Country_EU_All","Country_EU14","Country_EU8","Country_EU2","Country_EU_Other","Country_Europe_NonEU","Country_Europe_NonEU_All","Country_Africa","Country_Middle_East_Asia","Country_Americas","Country_Oceania","Country_British_Overseas")

country <- subset(country_input, select = -c(Date, Geography, Country_Europe_All,Country_EU14,Country_EU8,Country_EU2,Country_EU_Other,Country_Europe_NonEU))

num_cols <- setdiff(names(country)[sapply(country, is.numeric)], "All")
country[num_cols] <- lapply(country[num_cols], function(x) x / country$All)

country <- subset(country, select = -c(All))

joined_ks4_10 <- joined_ks4_9 |> left_join(country, by = "MSOA_code")
head(joined_ks4_10, 50)



```
```{r}
#Disability

disability_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Disability_Census.csv")
colnames(disability_input)

colnames(disability_input) <- c("Date","Geography","MSOA_code","All","Disabled_All","Disabled_Limited_Lot", "Disabled_Limited_Little","Not_Disabled_All","Not_Disabled_LongTermCondition","Not_Disabled_None")

disability <- subset(disability_input, select = -c(Date, Geography, Disabled_Limited_Lot, Disabled_Limited_Little,Not_Disabled_All))

num_cols <- setdiff(names(disability)[sapply(disability, is.numeric)], "All")
disability[num_cols] <- lapply(disability[num_cols], function(x) x / disability$All)

disability <- subset(disability, select = -c(All))

head(disability)

joined_ks4_11 <- joined_ks4_10 |> left_join(disability, by = "MSOA_code")
head(joined_ks4_11, 50)
```

```{r}
#Energy Efficiency
```

```{r}
#Ethnicity
```

```{r}
#Industry
industry_input = read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Industry_Census.csv")
colnames(industry_input)
industry <- subset(industry_input, select = c("geography.code", "Industry..current...Total..All.usual.residents.aged.16.years.and.over.in.employment.the.week.before.the.census", "Industry..current...A..Agriculture..Forestry.and.fishing","Industry..current...B..Mining.and.quarrying","Industry..current...C..Manufacturing","Industry..current...D..Electricity..gas..steam.and.air.conditioning.supply","Industry..current...E...Water.supply..Sewerage..Waste.management.and.Remediation.activities","Industry..current...F..Construction","Industry..current...G..Wholesale.and.retail.trade..repair.of.motor.vehicles.and.motorcycles","Industry..current...H..Transport.and.storage","Industry..current...I..Accommodation.and.food.service.activities","Industry..current...J..Information.and.communication","Industry..current...K..Financial.and.insurance.activities","Industry..current...L..Real.estate.activities","Industry..current...M..Professional..scientific.and.technical.activities","Industry..current...N..Administrative.and.support.service.activities","Industry..current...O..Public.administration.and.defence..compulsory.social.security","Industry..current...P..Education","Industry..current...Q..Human.health.and.social.work.activities","Industry..current...R..S..T..U.Other"))

colnames(industry) <- c("MSOA_code","All", "Industry_A_Agriculture","Industry_B_Mining","Industry_C_Manufacturing","Industry_D_Electricity","Industry_E_Water","Industry_F_Construction","Industry_G_Retail","Industry_H_Transport","Industry_I_Accommodation","Industry_J_Information","Industry_K_Financial","Industry_L_Real_Estate","Industry_M_Professional_Technical","Industry_N_Admin","Industry_O_Defence","Industry_P_Education","Industry_Q_Health","Industry_R_Other")

num_cols <- setdiff(names(industry)[sapply(industry, is.numeric)], "All")
industry[num_cols] <- lapply(industry[num_cols], function(x) x / industry$All)

industry <- subset(industry, select = -c(All))

head(industry)

joined_ks4_12 <- joined_ks4_11 |> left_join(industry, by = "MSOA_code")
head(joined_ks4_12, 50)
```

```{r}
#Language
language_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Language_Census.csv")
colnames(language_input)
colnames(language_input) <- c("Date","Geography","MSOA_code","All","Language_EnglishWelsh_All","Language_EnglishWelsh_Some","Language_EnglishWelsh_Some_NoAdults","Language_EnglishWelsh_None")

language <- subset(language_input, select = -c(Date, Geography))

num_cols <- setdiff(names(language)[sapply(language, is.numeric)], "All")
language[num_cols] <- lapply(language[num_cols], function(x) x / language$All)

language <- subset(language, select = -c(All))

head(language)

joined_ks4_13 <- joined_ks4_12 |> left_join(language, by = "MSOA_code")
head(joined_ks4_13, 50)

```

```{r}
# Length of Residence
residence_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Length_Of_Residence_Census.csv")
colnames(residence_input)
colnames(residence_input) <- c("Date","Geography","MSOA_code","All","Residence_Born_UK","Residence_10_Plus","Residence_5to10","Residence_2to5","Residence_Under2")

num_cols <- setdiff(names(residence_input)[sapply(residence_input, is.numeric)], "All")
residence_input[num_cols] <- lapply(residence_input[num_cols], function(x) x / residence_input$All)

residence <- subset(residence_input, select = -c(All, Date, Geography))

head(residence)

joined_ks4_14 <- joined_ks4_13 |> left_join(residence, by = "MSOA_code")
head(joined_ks4_14, 50)

```

```{r}
#Living arrangements
living_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Living_Arrangements_Census.csv")
colnames(living_input)

colnames(living_input) <- c("Date","Geography","MSOA_code","All","Living_Couple_All","Living_Marriage_All","Living_Marriage_Opposite","Living_Marriage_Same","Living_Separated_Married","Living_Cohabiting_All","Living_Cohabiting_Opposite","Living_Cohabiting_Same","Living_Single_All","Living_Single_NeverMarried","Living_Single_Married","Living_Single_Separated","Living_Single_Divorced","Living_Single_Widowed")

living <- subset(living_input, select = -c(Date, Geography, Living_Couple_All,Living_Marriage_All,Living_Cohabiting_All,Living_Single_All))

num_cols <- setdiff(names(living)[sapply(living, is.numeric)], "All")
living[num_cols] <- lapply(living[num_cols], function(x) x / living$All)

living <- subset(living, select = -c(All))

head(living)

joined_ks4_15 <- joined_ks4_14 |> left_join(living, by = "MSOA_code")
head(joined_ks4_15, 50)


```

```{r}
#Occupation
occupation_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\Occupation_Census.csv")
colnames(occupation_input)

library(stringr)

colnames(occupation_input) <- paste("Occupation", str_extract(colnames(occupation_input), "\\d+"), sep = "_")
colnames(occupation_input)[0:4] <- c("Date","Geography","MSOA_code","All")

colnames(occupation_input)

num_cols <- setdiff(names(occupation_input)[sapply(occupation_input, is.numeric)], "All")
occupation_input[num_cols] <- lapply(occupation_input[num_cols], function(x) x / occupation_input$All)

head(occupation_input)

occupation <- subset(occupation_input, select = -c(Date, Geography, All))

head(occupation)

joined_ks4_16 <- joined_ks4_15 |> left_join(occupation, by = "MSOA_code")
head(joined_ks4_16, 50)
     


```

```{r}
#Vote 2019
vote_2019_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\HoC-GE2019-results-by-constituency.csv")
colnames(vote_2019_input)

vote_2019 <- subset(vote_2019_input, select = c("ONS.ID","Electorate","Valid.votes","Con","Lab","LD","BRX","Green","All.other.candidates"))
vote_2019$Vote2019_No_Vote <- vote_2019$Electorate - vote_2019$Valid.votes

num_cols <- setdiff(names(vote_2019)[sapply(vote_2019, is.numeric)], "Electorate")
vote_2019[num_cols] <- lapply(vote_2019[num_cols], function(x) x / vote_2019$Electorate)

colnames(vote_2019) <- c("PCON_CODE","Electorate","All","Vote2019_Con","Vote2019_Lab","Vote2019_LD","Vote2019_BRX","Vote2019_Green","Vote2019_Other","Vote2019_None")
vote_2019 <- subset(vote_2019, select = -c(Electorate, All))

vote_2019[c("PCON_CODE")] <- lapply(vote_2019[c("PCON_CODE")], function(x) gsub(" ", "", x))

head(vote_2019,100)

#joined_ks4_17 <- joined_ks4_16 |> left_join(vote_2019, by = "PCON_CODE")
#head(joined_ks4_17, 50)


```

```{r}
#Vote 2024
vote_2024_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\HoC-GE2024-results-by-constituency.csv")
colnames(vote_2024_input)

vote_2024 <- subset(vote_2024_input, select = c("ONS.ID", "Constituency.name","Electorate","Valid.votes","Con","Lab","LD","RUK","Green","All.other.candidates"))
vote_2024$Vote2024_No_Vote <- vote_2024$Electorate - vote_2024$Valid.votes

num_cols <- setdiff(names(vote_2024)[sapply(vote_2024, is.numeric)], "Electorate")
vote_2024[num_cols] <- lapply(vote_2024[num_cols], function(x) x / vote_2024$Electorate)

colnames(vote_2024) <- c("PCON_CODE", "PCON_NAME","Electorate","All","Vote2024_Con","Vote2024_Lab","Vote2024_LD","Vote2024_RUK","Vote2024_Green","Vote2024_Other","Vote2024_None")
vote_2024 <- subset(vote_2024, select = -c(Electorate, All, PCON_CODE))

#vote_2024[c("PCON_CODE")] <- lapply(vote_2024[c("PCON_CODE")], function(x) gsub(" ", "", x))

head(vote_2024,100)

joined_ks4_17 <- joined_ks4_16 |> left_join(vote_2024, by = "PCON_NAME")
head(joined_ks4_17, 5000)

```

```{r}
# Broadband
broadband_input = read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\BroadbandSpeed.csv")
colnames(broadband_input)

colnames(broadband_input) <- c("PCON_CODE","PCON_NAME","Broadband_Superfast","Broadband_Gigabit","Broadband_Broadband_Below_Obligation","Broadband_Download_Speed","Broadband_Under10Mbps","Broadband_Over30Mbps")

broadband_input$Broadband_Download_Speed <- broadband_input$Broadband_Download_Speed/1000
head(broadband_input)

broadband <- subset(broadband_input, select = -c(PCON_CODE))

joined_ks4_18 <- joined_ks4_17 |> left_join(broadband, by = "PCON_NAME")
head(joined_ks4_18, 50)

```

```{r}
#Indices of Deprivation
deprivation_input <- read.csv("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\File_7_-_All_IoD2019_Scores__Ranks__Deciles_and_Population_Denominators_3.csv")
colnames(deprivation_input)

deprivation <- subset(deprivation_input, select = c("LSOA.code..2011.", "Index.of.Multiple.Deprivation..IMD..Rank..where.1.is.most.deprived.", "Income.Rank..where.1.is.most.deprived.","Employment.Rank..where.1.is.most.deprived.","Education..Skills.and.Training.Rank..where.1.is.most.deprived.","Health.Deprivation.and.Disability.Rank..where.1.is.most.deprived.","Crime.Rank..where.1.is.most.deprived.","Barriers.to.Housing.and.Services.Rank..where.1.is.most.deprived.","Living.Environment.Rank..where.1.is.most.deprived.","Income.Deprivation.Affecting.Children.Index..IDACI..Rank..where.1.is.most.deprived.", "Children.and.Young.People.Sub.domain.Rank..where.1.is.most.deprived.","Adult.Skills.Sub.domain.Rank..where.1.is.most.deprived.","Geographical.Barriers.Sub.domain.Rank..where.1.is.most.deprived.","Wider.Barriers.Sub.domain.Rank..where.1.is.most.deprived.","Indoors.Sub.domain.Rank..where.1.is.most.deprived.","Outdoors.Sub.domain.Rank..where.1.is.most.deprived."))
#colnames(deprivation)
colnames(deprivation) <- c("LSOA_code","IMD_All","IMD_Income", "IMD_Employment","IMD_Education","IMD_Health","IMD_Crime","IMD_Housing","IMD_LivingEnvironment","IMD_IncomeChildren","IMD_Children","IMD_AdultSkills","IMD_Geographical","IMD_Wider","IMD_Indoors","IMD_Outdoors")
#colnames(deprivation)
head(deprivation)

max_IMD <- max(deprivation$IMD_All, na.rm = TRUE)
num_cols <- setdiff(names(deprivation)[sapply(deprivation, is.numeric)], "IMD_All")
deprivation[num_cols] <- lapply(deprivation[num_cols], function(x) x / max_IMD)

deprivation <- subset(deprivation, select = -c(IMD_All))

head(deprivation)

joined_ks4_19 <- joined_ks4_18 |> left_join(deprivation, by = "LSOA_code")
head(joined_ks4_19, 50)

```

```{r}
# crime - street
library(tidyverse)

main_folder <- "C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\CrimeData"
subfolders <- list.dirs(main_folder, recursive = FALSE)

# Combine ALL data first
all_data <- map_dfr(subfolders, function(subfolder) {
  
  street_files <- list.files(
    path = subfolder,
    pattern = "street",
    full.names = TRUE
  )
  
  combined_df <- map_dfr(street_files, read_csv)
  
  combined_df %>%
    select(`Crime ID`, `LSOA code`, `Crime type`)
})

# THEN pivot once on the complete dataset
final_df <- all_data %>%
  count(`LSOA code`, `Crime type`, name = "crime_count") %>%
  pivot_wider(
    names_from = `Crime type`,
    values_from = crime_count,
    values_fill = 0
  )

head(final_df)
# Do your manipulation
#processed_df <- combined_df %>%
# your transformations here
#mutate(source_folder = basename(subfolder))  # example: track which folder
```
```{r}
crime <- final_df
colnames(crime) <- c("LSOA_code","StreetCrime_AntiSocialBehaviour","StreetCrime_BicycleTheft","StreetCrime_Burglary","StreetCrime_CriminalDamageArson","StreetCrime_Drugs","StreetCrime_OtherCrime","StreetCrime_OtherTheft","StreetCrime_PossessionWeapons","StreetCrime_PublicOrder","StreetCrime_Robbery","StreetCrime_Shoplifting","StreetCrime_THeftFromPerson","StreetCrime_VehicleCrime","StreetCrime_ViolenceSexualOffences")

num_cols <- setdiff(names(crime)[sapply(crime, is.numeric)], "LSOA_code")
crime[num_cols] <- lapply(crime[num_cols], function(x) x / 365)

head(crime)

joined_ks4_20 <- joined_ks4_19 |> left_join(crime, by = "LSOA_code")
head(joined_ks4_20, 50)
```
```{r}
write_csv(joined_ks4_20, file.path("C:\\Users\\jezkn\\Local\\Data Science Projects\\School Data\\2023-2024\\Data\\output.csv"))
```

```{r}
# mean income
```

```{r}
# life expectancy
```

```{r}
# #GDP per MSOA
```

